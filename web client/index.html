<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
</head>
<body style="margin: 0px;width:100%; height: 100%;">
<div id="inputs" style="margin: 0px;width:100%; height: 100%;">
  <label for="IP_ADDRESS">Insert the server IP Address</label>
  <input type="text" name="IP_ADDRESS" id="IP_ADDRESS" value="192.168.0.3"><br>
  <label for="PORT_IMAGE">Insert the image port</label>
  <input type="text" name="PORT_IMAGE" id="PORT_IMAGE" value="5000"><br>
  <label for="PORT_MOUSE">Insert the mouse port</label>
  <input type="text" name="PORT_MOUSE" id="PORT_MOUSE" value="433"><br>
  <label for="CONN_KEY">Insert the connection key</label>
  <input type="text" name="CONN_KEY" id="CONN_KEY" value=""><br>
  <input type="button" onclick="set_config()" value="Connect">
</div>
<script type="text/javascript">
    let ip_address = 0;
    let port_image = 0;
    let port_mouse = 0;
    let socket = 0;
    let key = 0;

    function set_config(){
      ip_address = document.getElementById("IP_ADDRESS").value;
      port_image = document.getElementById("PORT_IMAGE").value;
      port_mouse = document.getElementById("PORT_MOUSE").value;
      key = document.getElementById("CONN_KEY").value;
      document.body.style.backgroundImage = "url("+"http://"+ip_address+":"+port_image+"/video_feed?key=" + key+")";
      document.body.style.backgroundSize = ' 100% 100%';
      document.body.style.backgroundRepeat = 'no-repeat';
      document.body.style.backgroundAttachment = "fixed";
      socket = new WebSocket("ws://"+ip_address+":"+port_mouse+"/")
      socket.onopen = function(e) {
        console.log("[open] Connection established");
        console.log("Answering the server");
        socket.send("Connected;" + window.innerWidth + "*" + window.innerHeight);
      };
      socket.onclose = function(event) {
        if (event.wasClean) {
          console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
        } else {
          console.log('[close] Connection died');
        }
      };
      document.addEventListener('click', function(e) {
        socket.send(key+";"+event.clientX+"."+event.clientY);
      });
      document.getElementById("inputs").remove()
    }
  </script>
</body>
</html>

